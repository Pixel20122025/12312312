<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>LP Visual Solver Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #0f172a;
  --panel: rgba(30, 41, 59, 0.7);
  --accent: #6366f1;
  --accent-hover: #818cf8;
  --secondary: #ec4899;
  --success: #10b981;
  --text-main: #f8fafc;
  --text-dim: #94a3b8;
  --border: rgba(255, 255, 255, 0.1);
  --input-bg: rgba(15, 23, 42, 0.6);
}

* { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }

body {
  margin: 0;
  min-height: 100vh;
  background: radial-gradient(circle at 0% 0%, #1e1b4b 0%, #0f172a 100%);
  color: var(--text-main);
  display: flex;
  justify-content: center;
  padding: 24px;
}

.app-shell {
  width: 100%;
  max-width: 1280px;
  display: grid;
  grid-template-columns: 400px 1fr;
  gap: 24px;
}

.sidebar {
  background: var(--panel);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 24px;
  padding: 32px;
  display: flex;
  flex-direction: column;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
  max-height: 90vh;
}

h1 {
  font-size: 24px;
  font-weight: 700;
  margin: 0 0 8px 0;
  background: linear-gradient(to right, #fff, var(--text-dim));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.subtitle { color: var(--text-dim); font-size: 14px; margin-bottom: 32px; }

.section-label {
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-size: 12px;
  font-weight: 700;
  color: var(--accent);
  margin-bottom: 16px;
  display: block;
}

.input-group {
  display: flex;
  align-items: center;
  gap: 12px;
  background: var(--input-bg);
  padding: 12px 16px;
  border-radius: 12px;
  border: 1px solid var(--border);
  margin-bottom: 8px;
}

input[type="number"] {
  background: transparent;
  border: none;
  color: white;
  width: 60px;
  font-weight: 600;
  font-size: 16px;
  outline: none;
}

.constraints-container {
  flex-grow: 1;
  margin: 10px 0;
  overflow-y: auto;
  padding-right: 8px;
}

.constraint-card {
  background: rgba(255,255,255,0.03);
  padding: 10px;
  border-radius: 12px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
  border: 1px solid var(--border);
}

.btn {
  padding: 12px 20px;
  border-radius: 12px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn-primary { background: var(--accent); color: white; width: 100%; }
.btn-primary:hover { background: var(--accent-hover); transform: translateY(-1px); }
.btn-ghost { background: rgba(255,255,255,0.05); color: white; border: 1px solid var(--border); }
.btn-danger { background: rgba(239, 68, 68, 0.1); color: #ef4444; padding: 6px 10px; }

.main-view { display: flex; flex-direction: column; gap: 20px; }

.canvas-container {
  background: #020617;
  border-radius: 24px;
  border: 1px solid var(--border);
  position: relative;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
  flex-grow: 1;
  min-height: 600px;
}

svg { width: 100%; height: 100%; }

.results-bar {
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid rgba(16, 185, 129, 0.2);
  border-radius: 16px;
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
}

.stat-box .label { font-size: 12px; color: var(--success); text-transform: uppercase; }
.stat-box .value { font-size: 20px; font-weight: 700; color: white; }

@media (max-width: 1000px) {
  .app-shell { grid-template-columns: 1fr; }
  .sidebar { order: 2; max-height: none; }
  .main-view { order: 1; }
}
</style>
</head>
<body>

<div class="app-shell">
  <aside class="sidebar">
    <div style="display:flex; justify-content: space-between; align-items: flex-start;">
      <div>
        <h1>LP Visualizer</h1>
        <p class="subtitle">Графічний метод</p>
      </div>
      <button id="reset" class="btn btn-ghost" style="padding: 6px 10px; font-size: 11px;">Reset</button>
    </div>

    <span class="section-label">Цільова функція (Max)</span>
    <div class="input-group">
      <input id="coeffA" type="number" value="3"/>
      <span style="color:var(--text-dim)">x₁ +</span>
      <input id="coeffB" type="number" value="2"/>
      <span style="color:var(--text-dim)">x₂</span>
    </div>

    <label style="margin: 15px 0; display: flex; align-items: center; gap: 10px; cursor: pointer;">
      <input id="nonneg" type="checkbox" checked style="accent-color: var(--accent); width: 18px; height: 18px;">
      <span style="font-size: 13px;">Обмеження x₁, x₂ ≥ 0</span>
    </label>

    <span class="section-label">Обмеження (≤)</span>
    <div class="constraints-container" id="constraintsList"></div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
      <button id="addCons" class="btn btn-ghost">＋ Додати</button>
      <button id="solve" class="btn btn-primary">Обчислити</button>
    </div>
  </aside>

  <main class="main-view">
    <div class="canvas-container">
      <svg id="svg" viewBox="0 0 600 600">
        <defs>
          <pattern id="grid" width="30" height="30" patternUnits="userSpaceOnUse">
            <path d="M 30 0 L 0 0 0 30" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#grid)" />
        <g id="viewport"></g>
      </svg>
    </div>

    <div class="results-bar" id="results" style="display: none;">
      <div class="stat-box">
        <div class="label">Оптимальне x₁</div>
        <div class="value" id="resX1">-</div>
      </div>
      <div class="stat-box">
        <div class="label">Оптимальне x₂</div>
        <div class="value" id="resX2">-</div>
      </div>
      <div class="stat-box">
        <div class="label">Максимум F</div>
        <div class="value" id="resF">-</div>
      </div>
    </div>
  </main>
</div>

<script>
const svg = document.getElementById("svg");
const viewport = document.getElementById("viewport");
const list = document.getElementById("constraintsList");
const resultsBar = document.getElementById("results");

let constraints = [
  {id: 1, c: 1, d: 2, s: 10},
  {id: 2, c: 2, d: 1, s: 8},
  {id: 3, c: 0, d: 1, s: 4}
];

const SCALE = 30; // 1 одиниця = 30px
const SIZE = 600;

function renderList() {
  list.innerHTML = "";
  constraints.forEach(l => {
    const r = document.createElement("div");
    r.className = "constraint-card";
    r.innerHTML = `
      <input type="number" value="${l.c}" onchange="updateVal(${l.id},'c',this.value)">
      <span>x₁+</span>
      <input type="number" value="${l.d}" onchange="updateVal(${l.id},'d',this.value)">
      <span>x₂≤</span>
      <input type="number" value="${l.s}" onchange="updateVal(${l.id},'s',this.value)">
      <button class="btn btn-danger" onclick="remove(${l.id})">✕</button>`;
    list.appendChild(r);
  });
}

function updateVal(id, f, v) {
  const c = constraints.find(x => x.id === id);
  if(c) c[f] = parseFloat(v) || 0;
  draw();
}

function remove(id) {
  constraints = constraints.filter(x => x.id !== id);
  renderList(); draw();
}

function isFeasible(x, y) {
  if (document.getElementById("nonneg").checked && (x < -0.01 || y < -0.01)) return false;
  return constraints.every(l => (l.c * x + l.d * y) <= l.s + 0.01);
}

function solve() {
  let best = null, maxF = -Infinity;
  for(let x=0; x<=20; x+=0.1) {
    for(let y=0; y<=20; y+=0.1) {
      if(isFeasible(x, y)) {
        let f = x * +coeffA.value + y * +coeffB.value;
        if(f > maxF) { maxF = f; best = {x, y}; }
      }
    }
  }
  if(best) {
    resultsBar.style.display = "grid";
    resX1.textContent = best.x.toFixed(2);
    resX2.textContent = best.y.toFixed(2);
    resF.textContent = maxF.toFixed(2);
    draw(best);
  }
}

function draw(opt) {
  viewport.innerHTML = "";

  // 1. Малюємо область допустимих рішень (Scanline visualization)
  const region = document.createElementNS("http://www.w3.org/2000/svg", "path");
  let d = "";
  for(let x=0; x<=20; x+=0.2) {
    let minY = -1, maxY = -1;
    for(let y=0; y<=20; y+=0.2) {
      if(isFeasible(x,y)) {
        if(minY === -1) minY = y;
        maxY = y;
      }
    }
    if(minY !== -1) {
      d += `${x==0?'M':'L'} ${x*SCALE} ${SIZE - maxY*SCALE} `;
    }
  }
  // Замикаємо шлях по осі X для коректної заливки
  d += `L 20 600 L 0 600 Z`; 
  region.setAttribute("d", d);
  region.setAttribute("fill", "rgba(99, 102, 241, 0.2)");
  viewport.appendChild(region);

  // 2. Осі координат
  const axes = document.createElementNS("http://www.w3.org/2000/svg", "g");
  axes.innerHTML = `
    <line x1="0" y1="${SIZE}" x2="${SIZE}" y2="${SIZE}" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
    <line x1="0" y1="0" x2="0" y2="${SIZE}" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
    <text x="${SIZE-20}" y="${SIZE-10}" fill="white" font-size="12">x₁</text>
    <text x="10" y="20" fill="white" font-size="12">x₂</text>
  `;
  viewport.appendChild(axes);

  // 3. Лінії обмежень
  constraints.forEach(l => {
    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    let x1, y1, x2, y2;
    if(l.d !== 0 && l.c !== 0) {
      x1 = 0; y1 = l.s/l.d; x2 = l.s/l.c; y2 = 0;
    } else if (l.d === 0) {
      x1 = l.s/l.c; y1 = 0; x2 = l.s/l.c; y2 = 20;
    } else {
      x1 = 0; y1 = l.s/l.d; x2 = 20; y2 = l.s/l.d;
    }
    line.setAttribute("x1", x1*SCALE); line.setAttribute("y1", SIZE-y1*SCALE);
    line.setAttribute("x2", x2*SCALE); line.setAttribute("y2", SIZE-y2*SCALE);
    line.setAttribute("stroke", "var(--accent)");
    line.setAttribute("stroke-width", "2");
    viewport.appendChild(line);
  });

  // 4. Точка оптимуму
  if(opt) {
    const dot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    dot.setAttribute("cx", opt.x*SCALE);
    dot.setAttribute("cy", SIZE-opt.y*SCALE);
    dot.setAttribute("r", "6");
    dot.setAttribute("fill", "var(--secondary)");
    dot.setAttribute("style", "filter: drop-shadow(0 0 8px var(--secondary))");
    viewport.appendChild(dot);
  }
}

addCons.onclick = () => {
  constraints.push({id: Date.now(), c: 1, d: 1, s: 5});
  renderList(); draw();
};
solve.onclick = solve;
reset.onclick = () => {
  constraints = [{id: 1, c: 1, d: 2, s: 10}, {id: 2, c: 2, d: 1, s: 8}];
  coeffA.value = 3; coeffB.value = 2;
  resultsBar.style.display = "none";
  renderList(); draw();
};

renderList(); draw();
</script>

</body>
</html>
